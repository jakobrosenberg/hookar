{"version":3,"sources":["../esm/index.mjs"],"names":["createHooksCollection","runner","hooks","hooksCollection","hook","push","splice","indexOf","run","runOnce","next","unhook","createPipelineCollection","type","value","rest","reduce","pipedValue","then","r","createSequenceHooksCollection","last","_","createParallelHooksCollection","Promise","all","map","createGuardsCollection"],"mappings":"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","sourcesContent":["/**\n * @template H\n * @callback AddHookToCollection\n * @param {H} hook\n * @returns {function} unhook\n **/\n\nimport { runOnce } from \"./util.mjs\";\n\n/**\n * @template H\n * @typedef {AddHookToCollection<H> & HooksCollectionProps<H>} HooksCollection\n */\n\n/**\n * @template H hook\n * @typedef {Object} HooksCollectionProps\n * @prop {H} run\n * @prop {H} runOnce\n * @prop {HookCb<H>} next\n * @prop {H[]} hooks\n */\n\n/**\n * @template  V\n * @callback Runner\n * @param {HookCb<V>[]} value\n * @param  {...any} rest\n */\n\n/**\n * @template T\n * @callback HookCb\n * @param {T} value\n * @param {...any} rest\n */\n\n/**\n * creates a hook collection\n * @template T\n * @param {Runner<T>} runner\n * @return {HooksCollection<HookCb<T>>}\n * @example\n * const hooksCollection = createHook()\n * const unhookFn = hooksCollection(x => console.log('hello', x))\n * const unhookFn2 = hooksCollection(x => console.log('goodbye', x))\n *\n * // call hooks\n * hooksCollection.hooks.forEach(hook => hook('Jake'))\n * // logs \"hello Jake\" and \"goodbye Jake\"\n *\n * // unregister\n * unhookFn()\n * unhookFn2()\n */\nconst createHooksCollection = (runner) => {\n  /** @type {HookCb<T>[]} */\n  const hooks = [];\n\n  /**\n   *@type {HooksCollection<HookCb<T>>}\n   */\n  const hooksCollection = (hook) => {\n    hooks.push(hook);\n    return () => hooks.splice(hooks.indexOf(hook), 1);\n  };\n\n  hooksCollection.hooks = hooks;\n  hooksCollection.run = runner(hooks);\n  hooksCollection.runOnce = runOnce(runner(hooks));\n  hooksCollection.next = (hook) => {\n    const unhook = hooksCollection((...payload) => {\n      hook(...payload);\n      unhook();\n    });\n  };\n\n  return hooksCollection;\n};\n\n/**\n * @template P\n * @typedef {HooksCollection<(pri: P, ...rest)=>P>} CollectionSync\n */\n/**\n * @template P\n * @typedef {HooksCollection<(pri: P, ...rest)=>P|Promise<P>>} CollectionAsync\n */\n/**\n * @template P\n * @typedef {HooksCollection<((pri: P, ...rest)=>void)>} CollectionSyncVoid\n */\n/**\n * @template P\n * @typedef {HooksCollection<(pri: P, ...rest)=>void|Promise<void>>} CollectionAsyncVoid\n */\n\n/**\n * @template T\n * @param {T=} type\n * @returns {HooksCollection<T>}\n */\nexport const createPipelineCollection = (type) =>\n  // @ts-ignore\n  createHooksCollection(\n    (hooks) =>\n      (value, ...rest) =>\n        hooks.reduce(\n          (pipedValue, hook) =>\n            pipedValue?.then ? pipedValue.then((r) => hook(r, ...rest)) : hook(pipedValue, ...rest),\n          value\n        )\n  );\n\n/**\n * @template T\n * @param {T=} type\n * @returns {CollectionSyncVoid<T>|CollectionAsyncVoid<T>}\n */\nexport const createSequenceHooksCollection = (type) =>\n  createHooksCollection(\n    (hooks) =>\n      (value, ...rest) =>\n        hooks.reduce(\n          (last, hook) => (last?.then ? last.then((_) => hook(value, ...rest)) : hook(value, ...rest)),\n          value\n        )\n  );\n\n/**\n * @template T\n * @param {T=} type\n * @returns {CollectionSyncVoid<T>|CollectionAsyncVoid<T>}\n */\nexport const createParallelHooksCollection = (type) =>\n  createHooksCollection(\n    (hooks) =>\n      (value, ...rest) =>\n        Promise.all(hooks.map((hook) => hook(value, ...rest))).then((r) => value)\n  );\n\n/**\n * @template T\n * @param {T=} type\n * @returns {CollectionSync<T>|CollectionAsync<T>}\n */\nexport const createGuardsCollection = (type) =>\n  // @ts-ignore\n  createHooksCollection(\n    (hooks) =>\n      (value, ...rest) =>\n        hooks.reduce(\n          (pipedValue, hook) =>\n            pipedValue?.then ? pipedValue.then((r) => r && hook(value, ...rest)) : pipedValue && hook(value, ...rest),\n          value || true\n        )\n  );\n"],"file":"index.js"}